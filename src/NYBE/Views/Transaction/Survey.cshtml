@model NYBE.Models.TransactionViewModels.SurveyViewModel

@{
    ViewData["Title"] = Model.buyers.Any() ? "Confirmation Survey" : "Oops..";
}

<h2 class="text-center">@ViewData["Title"]</h2>

<div class="row">
    <div class="col-sm-10 col-sm-offset-1">
        <hr />
        @if (Model.buyers.Any())
        {
            <form asp-controller="Transaction" asp-action="Survey" method="post" class="form-horizontal">
                <div class="form-group">
                    <div class="col-sm-2 col-sm-offset-3">
                        <h4>Buyer:</h4>
                    </div>
                    <div class="col-sm-5">
                        <select asp-for="buyerId" class="form-control">
                            @foreach (ApplicationUser user in Model.buyers)
                            {
                                <option value="@user.Id">@user.FirstName @user.LastName</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-2 col-sm-offset-3">
                        <h4>Course:</h4>
                    </div>
                    <div class="col-sm-5">
                        <select asp-for="courseID" id="courseID" class="form-control" name="courseID">
                            @foreach (Course course in Model.courses)
                            {
                                if (course.ID == Model.listing.CourseID)
                                {
                                    <option value="@course.ID" selected>@course.Dept - @course.CourseNum @course.Name</option>
                                }
                                else
                                {
                                    <option value="@course.ID">@course.Dept - @course.CourseNum @course.Name</option>
                                }
                            }
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-2 col-sm-offset-3">
                        <h4>Condition:</h4>
                    </div>
                    <div class="col-sm-5">
                        <select asp-for="condition" class="form-control" name="condition">
                            <option selected disabled hidden>@Model.condition</option> <!--Show the previous condition-->
                            <option value="New">New</option>
                            <option value="Excellent">Excellent</option>
                            <option value="Good">Good</option>
                            <option value="Fair">Fair</option>
                            <option value="Bad">Bad</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-2 col-sm-offset-3">
                        <h4>Trade:</h4>
                    </div>
                    <div class="col-sm-5">
                        <input name="listingTradeCheckBox" id="listingTradeCheckBox" type="checkbox" data-toggle="toggle" @(Model.listing.AskingPrice < 0 ? "checked" : "")>
                    </div>
                </div>
                <div class="form-group row" id="listingPrice" @(Model.listing.AskingPrice < 0 ? "hidden" : "")>
                    <div class="col-sm-2 col-sm-offset-3">
                        <h4>Final Price:</h4>
                    </div>
                    <div class="col-sm-5">
                        <input asp-for="finalPrice" class="form-control" type="number" min="0" value="@Model.listing.AskingPrice" id="price" step="0.01" />
                    </div>
                </div>
                <hr />
                <div class="col-sm-8 col-sm-offset-5">
                    <button type="button" onclick="history.go(-1)" class="btn btn-danger">Cancel</button>
                    <button type="button" class="btn btn-success" data-toggle="modal" data-target="#confirmModal">Submit</button>
                </div>
                <!-- Modal -->
                <div class="modal fade" id="confirmModal" role="dialog">
                    <div class="modal-dialog">
                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header alert-warning">
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                <h4 class="modal-title">Survey Confirmation</h4>
                            </div>
                            <div class="modal-body">
                                <p>Ensure all this information is correct!</p>
                                <p>Once submitted, no changes can be made unless the buyer denies this purchase.</p>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-success">Accept</button>
                                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        }
        else
        {
            <div class="form-group">
                <div class="col-sm-7 col-sm-offset-4">
                    <h4>You have no buyers for this book!</h4>
                </div>
            </div>
            <div class="col-sm-8 col-sm-offset-5">
                <button type="button" id="back" onclick="history.go(-1)" class="btn btn-primary">Cancel</button>
            </div>
        }
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
